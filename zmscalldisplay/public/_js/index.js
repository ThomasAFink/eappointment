var e=require("jquery"),t=require("qrcode-generator");function i(e){return e&&e.__esModule?e.default:e}var n=class{constructor(t){this.$main=i(e)(t)}get $(){return this.$main}bindPublicMethods(...e){let t=this;e.forEach(function(e){if("function"!=typeof t[e])throw"Method not found: "+e;t[e]=t[e].bind(t)})}},a=class extends n{constructor(e){super(e),this.bindPublicMethods("initSoundCheck")}initSoundCheck(){let t=i(e)("#ring");this.hasNewQueueId()&&t.get(0).play();let n=this.getCalledQueueIds();this.writeCalledQueueIds(n)}getNewQueueIds(){let t=this.getCalledQueueIds(),n=window.bo.zmscalldisplay.queue.calledIds;return i(e)(t).not(n).get()}hasNewQueueId(){return 0<this.getNewQueueIds().length}getCalledQueueIds(){let t=[];return i(e)("#queueImport td.wartenummer span[data-status]").each(function(){("called"==i(e)(this).attr("data-status")||"pickup"==i(e)(this).attr("data-status"))&&t.push(i(e)(this).attr("data-appointment"))}),t.sort((e,t)=>e-t).join(","),t}writeCalledQueueIds(e){window.bo.zmscalldisplay.queue.calledIds=e}},o=class extends n{constructor(t){super(t),this.bindPublicMethods("initRequest","setInterval"),console.log("Found queueList container"),i(e)(window).on("load",()=>{this.initRequest()}),i(e).ajaxSetup({cache:!1})}initRequest(){let t={type:"POST",url:this.getUrl("/queue/"),data:window.bo.zmscalldisplay,timeout:1e3*window.bo.zmscalldisplay.reloadInterval-100};i(e).ajax(t).done(t=>{this.hideMessages(0),i(e)("#queueImport").html(t);var n=new a;n.getNewQueueIds().forEach(t=>{var n=i(e)('span[data-appointment="'+t+'"]');this.blinkElements(n,3,900)}),n.initSoundCheck(),this.getDestinationToNumber()}).fail(function(){i(e)(".fatal").show()}),this.setInterval()}setInterval(){var e=window.bo.zmscalldisplay.reloadInterval;setTimeout(this.initRequest,1e3*e)}getUrl(e){return window.bo.zmscalldisplay.includepath+e}getDestinationToNumber(){window.bo.zmscalldisplay.queue.showOnlyNumeric&&i(e)("#queueImport .destination").each(function(){let t=i(e)(this).text();/\d/g.test(t)&&i(e)(this).text(t.replace(/\D/g,""))})}hideMessages(t=5e3){let n=i(e).find("[data-hide-message]");n.length&&setTimeout(()=>{i(e)(n).fadeOut()},t)}async blinkElements(t,n,a){let o=async()=>{let n=t.map(function(){return i(e)(this).css("color")});t.css("color","rgb(27, 152, 213)"),await new Promise(e=>setTimeout(e,a)),t.each(function(t){i(e)(this).css("color",n[t])}),await new Promise(e=>setTimeout(e,a))};for(let e=0;e<n;e++)await o()}},s=class{constructor(){setInterval(this.setClock,1e3),this.setDate()}setClock(){if(document.querySelector(".second-hand")&&this.setAnalogClock(),document.querySelector(".digital-clock")){let e=new Date;document.querySelector(".digital-clock").innerHTML=new Intl.DateTimeFormat("de-DE",{hour:"2-digit",minute:"2-digit"}).format(e),document.querySelector(".digital-datum").innerHTML=new Intl.DateTimeFormat("de-DE",{weekday:"long",year:"numeric",month:"2-digit",day:"2-digit"}).format(e)}}setAnalogClock(){let e=new Date,t=document.querySelector(".second-hand"),i=document.querySelector(".min-hand"),n=document.querySelector(".hour-hand"),a=e.getSeconds();t.style.transform=`rotate(${a/60*360+90}deg)`;let o=e.getMinutes();i.style.transform=`rotate(${o/60*360+a/60*6+90}deg)`;let s=e.getHours();n.style.transform=`rotate(${s/12*360+o/60*30+90}deg)`}setDate(){let e=document.querySelector("#aufrufanzeige_Datum"),t=new Date;e&&(e.innerHTML=new Intl.DateTimeFormat("de-DE",{weekday:"long",year:"numeric",month:"2-digit",day:"2-digit"}).format(t))}},l=class extends n{constructor(t){super(t),this.bindPublicMethods("load","setInterval"),console.log("Found waitingInfo container"),i(e)(window).on("load",()=>{this.load()}),i(e).ajaxSetup({cache:!1})}load(){new s;let t={type:"POST",url:this.getUrl("/waitinginfo/"),data:window.bo.zmscalldisplay,timeout:1e3*window.bo.zmscalldisplay.queue.timeWaitingInfo-100};i(e).ajax(t).done(e=>{this.hideMessages(0),this.setWaitingClients(e),this.setWaitingTime(e)}).fail(function(){i(e)(".fatal").show()}),this.setInterval()}setInterval(){var e=window.bo.zmscalldisplay.queue.timeWaitingInfo;setTimeout(this.load,1e3*e)}getUrl(e){return window.bo.zmscalldisplay.includepath+e}setWaitingClients(t){var n=i(e)(t).filter("div#waitingClients").text();0<=n&&i(e)("#wartende").html(n)}setWaitingTime(t){var n=i(e)(t).filter("div#waitingTime").text();i(e)("#wartezeit").html(n)}hideMessages(t=5e3){let n=i(e).find("[data-hide-message]");n.length&&setTimeout(()=>{i(e)(n).fadeOut()},t)}},d=class extends n{constructor(t){super(t),this.bindPublicMethods("initQrCode"),console.log("Found qrCode"),i(e)(window).on("load",()=>{this.initQrCode()})}initQrCode(){let t=window.bo.zmscalldisplay.qrCode,n=this;i(e)("canvas.qrCode").each(function(a,o){"CANVAS"===o.nodeName&&(t.size=Math.min(o.offsetWidth,o.offsetHeight),t.text=window.location.origin+i(e)(o).data("text"),n.drawQrCode(o,t))})}drawQrCode(e,n){i(t).stringToBytes=i(t).stringToBytesFuncs["UTF-8"];let a=i(t)(n.version,n.ecLevel);a.addData(n.text),a.make();let o=e.getContext("2d");o.fillStyle=n.backgroundColor,o.fillRect(0,0,n.size,n.size);let s=a.getModuleCount(),l=n.size/(s+2*n.quiet),d=n.quiet*l;o.beginPath(),o.fillStyle=n.fillColor;for(let e=0;e<s;e+=1)for(let t=0;t<s;t+=1){let i=d+e*l,n=d+t*l;a.isDark(e,t)&&o.rect(n,i,l,l)}o.fill()}};window.bo={zmscalldisplay:{tableLayout:{multiColumns:1,maxResults:5,head:{left:"Nummer",right:"Platz"}},collections:{},queue:{calledIds:"",timeUntilOld:60,timeWaitingInfo:20,status:"called,pickup",showOnlyNumeric:!1},reloadInterval:10,animationEnd:"webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",qrCode:{version:10,ecLevel:"M",fillColor:"#000",backgroundColor:"#fff",text:"no text",quiet:5}}},i(e)("#queueImport").each(function(){new o,new l}),new d,console.log("Welcome to the ZMS Calldisplay interface...");
//# sourceMappingURL=index.js.map
