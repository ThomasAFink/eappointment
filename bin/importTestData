#!/usr/bin/env php
<?php
$dir = is_dir(getcwd() . '/vendor/bo/zmsdb') ? realpath(getcwd()) : realpath(__DIR__);
while ($dir != '/' && !file_exists("$dir/config.php")) {
    $dir = dirname($dir);
    if (file_exists("$dir/autoload.php")) {
        require_once("$dir/autoload.php");
    }
}
if (file_exists("$dir/bootstrap.php")) {
    require("$dir/bootstrap.php");
} else {
    require("$dir/config.php");
}
if (isset($argv[1]) && $argv[1] == '--commit') {
    $fixtures = realpath(__DIR__ . '/../tests/Zmsdb/fixtures/');
    $migrations = realpath(__DIR__ . '/../migrations/');
    \BO\Zmsdb\Cli\Db::startTestDataImport($fixtures);
    \BO\Zmsdb\Cli\Db::startMigrations($migrations);
    \BO\Zmsdb\Cli\Db::startConfigDataImport();
    $importer = new \BO\Zmsdb\Source\Dldb();
    $importer->startImport(true);
} else {
    $dbname = \BO\Zmsdb\Connection\Select::$writeSourceName;
    echo "Usage: {$argv[0]} --commit\n\tATTENTION! Drops Database $dbname and writes Testdata. USE WITH CAUTION!\n\n"
        . "\t!!!!!!!!!!!!!!!!!!!!!!!\n"
        . "\t!! DATA LOSS WARNING !!\n"
        . "\t!!!!!!!!!!!!!!!!!!!!!!!\n\n";
}
