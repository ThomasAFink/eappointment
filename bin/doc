#!/bin/bash

REALPATH=$(which realpath || which readlink)
REALPATH=$([[ "$REALPATH" =~ 'readlink' ]] && echo "$REALPATH -e" || echo "$REALPATH")
DIR=$(dirname $($REALPATH ${BASH_SOURCE[0]}))
ROOT=$($REALPATH $DIR/..)

# build swagger.yaml file by partials
npm run doc
# get redoc and swagger bundle files from cdn server
wget -P $ROOT/public/doc/ "https://cdn.redoc.ly/redoc/latest/bundles/redoc.standalone.js"
wget -P $ROOT/public/_test/ "https://cdnjs.cloudflare.com/ajax/libs/swagger-ui/3.6.0/swagger-ui-bundle.js"
wget -P $ROOT/public/_test/ "https://cdnjs.cloudflare.com/ajax/libs/swagger-ui/3.6.0/swagger-ui.css"
wget -P $ROOT/public/_test/ "https://cdnjs.cloudflare.com/ajax/libs/swagger-ui/3.6.0/swagger-ui-standalone-preset.js"
# valdiate swagger.yaml file
swagger-cli validate $ROOT/public/doc/swagger.yaml
# build full resolved swagger.json by swagger.yaml
swagger-cli bundle -r -o $ROOT/public/doc/swagger.json $ROOT/public/doc/swagger.yaml