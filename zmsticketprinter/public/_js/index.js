var t=require("jquery"),e=require("js-cookie");function i(t){return t&&t.__esModule?t.default:t}var n=class{bindPublicMethods(...t){let e=this;t.forEach(function(t){if("function"!=typeof e[t])throw"Method not found: "+t;e[t]=e[t].bind(e)})}},o=class extends n{constructor(){super(),this._errorHandler=function(){}}get errorHandler(){return this._errorHandler}set errorHandler(t){this._errorHandler=t}},r=class{constructor(e,n){this.$main=i(t)(e),this.response=n.response,this.callback=n.callback||(()=>{}),this.parent=n.parent,this.handleLightbox=n.handleLightbox||(()=>{}),this.bindEvents(),this.render()}render(){var e=i(t)(this.response).filter("div.dialog");if(0==e.length){var n=i(t)(this.response).find("div.dialog");n.length>0&&(e=n.get(0).outerHTML)}this.$main.html(e)}bindEvents(){this.$main.off().on("click",".button-ok",t=>{t.preventDefault(),t.stopPropagation(),this.callback(t)}).on("click",".button-abort",t=>{t.preventDefault(),t.stopPropagation(),this.handleLightbox()}).on("click",".button-callback",e=>{e.preventDefault(),e.stopPropagation();var n=i(t)(e.target).data("callback");this.callback=this.parent[n],this.callback(e)})}};const s=(e,n)=>{let o=i(t)('<div class="lightbox"><div class="lightbox__content"></div></div>');e||(e=i(t)("body"),o.addClass("fixed"));let r=()=>{o.off(),o.remove()},s=o.find(".lightbox__content");return o.on("click",t=>{t.stopPropagation(),t.preventDefault(),r(),n()}).on("click",".lightbox__content",t=>{t.stopPropagation()}),i(t)(e).find(".lightbox").length&&i(t)(e).find(".lightbox").remove(),i(t)(e).append(o),{lightboxContentElement:s,destroyLightbox:r}};var a=class extends o{constructor(e){super(e),this.$main=i(t)(e)}get $(){return this.$main}static loadCallStatic(e,n="GET",o=null){let r={method:n};return("POST"===n||"PUT"===n)&&(r.data=o),new Promise((n,o)=>{i(t).ajax(e,r).done(t=>{n(t)}).fail(t=>{console.log("XHR load error",e,t),o(t)})})}static loadDialogStatic(t,e){let{lightboxContentElement:i,destroyLightbox:n}=s(this.$main,()=>{n(),e()});new r(i,{response:t,callback:()=>{e(),n()}})}},l=class extends a{constructor(t){super(t),this.bindPublicMethods("setReloadInterval","reloadPage"),console.log("Redirect to home url every 30 seconds."),this.setReloadInterval()}reloadPage(){console.log("reload..."),i(t).get(this.getUrl("/home/"),function(e){i(t)("body").html(i(t)(i(t).parseHTML(e)))})}setReloadInterval(){console.log("setInterval...");var t=window.bo.zmsticketprinter.reloadInterval;setInterval(this.reloadPage,1e3*t)}getUrl(t){return window.bo.zmsticketprinter.includepath+t}},d=class extends a{constructor(e){super(e),this.bindPublicMethods("load","setTimeout","getUrl","reloadPage"),i(t)(window).on("load",this.load)}load(){i(e).remove("Ticketprinter"),this.setTimeout()}reloadPage(){window.location.href=this.getUrl("/home/")}setTimeout(){setTimeout(this.reloadPage,5e3)}getUrl(t){return window.bo.zmsticketprinter.includepath+t}},c=class extends a{constructor(e){super(e),this.bindPublicMethods("printDialog","reload"),console.log("Print data and redirect to home url after presetted time"),i(t)(function(){this.printDialog})}reload(){window.location.href=this.getUrl("/home/")}getUrl(t){return window.bo.zmsticketprinter.includepath+t}printDialog(){document.title="Anmeldung an Warteschlange",window.print();var t=()=>{console.log("start printing")},e=()=>{setTimeout(()=>{this.reload()},1e3*window.bo.zmsticketprinter.reloadInterval)};window.matchMedia&&window.matchMedia("print").addListener(function(i){i.matches?t():e()}),window.onbeforeprint=t,window.onafterprint=e}},h=class extends a{constructor(t){super(t),this.element=t,this.initClock=this.initClock.bind(this),this.startClock()}initClock(){var e=new Date,n=e.getHours(),o=e.getMinutes(),r=e.getSeconds(),s=n<10?"0"+n:n;s+=(r%2==0?":":" ")+(o<10?"0"+o:o),i(t)(this.element).text(s)}startClock(){this.initClock(),setInterval(this.initClock,1)}},u=class extends a{constructor(t){super(t),this.source=this.$.attr("id"),"waitingNumberPad"==this.source?this.minNumberLength=1:this.minNumberLength=10,this.bindPublicMethods("appendNumber","deleteNumber","clearNumbers","checkNumber"),console.log("Found keyboard-handheld"),this.$.find("button.ziffer").on("click",this.appendNumber),this.$.find("button#removelastdigit").on("click",this.deleteNumber),this.$.find("button#removealldigitsphone").on("click",this.clearNumbers),this.$numberInput=this.$.find(".nummerneingabe")}appendNumber(e){let n=i(t)(e.target).closest("button").text();return this.$numberInput.val(this.$numberInput.val()+""+n),this.checkNumber(),!1}deleteNumber(){return this.$numberInput.val(this.$numberInput.val().replace(/.$/,"")),this.checkNumber(),!1}clearNumbers(){return this.$numberInput.val(""),this.checkNumber(),!1}checkNumber(){var t=this.$numberInput.val();"waitingNumberPad"==this.source&&(t=t.replace(/^0+/,"")),t=t.replace(/[^\d]/g,"");var e=this.$.find(".nachtrag");t.length>=this.minNumberLength?e.removeClass("disabled").attr("disabled",!1):e.hasClass("disabled")||e.addClass("disabled").attr("disabled",!0),this.$numberInput.val(t)}},m=e=>{let n=i(t)(e);n.on("submit",t=>{!0===n.data("submitted")?(t.stopPropagation(),t.preventDefault()):n.data("submitted",!0)})};window.$=i(t),window.bo={zmsticketprinter:{reloadInterval:30,animationEnd:"webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",includeUrl:"/terminvereinbarung/ticketprinter"}},i(t)("#newhash").each(function(){new d(this)}),i(t)("#index, #message, #exception").each(function(){new l(this)}),i(t)("#process").each(function(){new c(this)}),i(t)(".digitaluhr").length>0?(console.log("Found digitaluhr elements, initializing DigitalTime..."),i(t)(".digitaluhr").each(function(){new h(this)})):console.log("No digitaluhr elements found."),i(t)(".smsbox").each(function(){new u(this)}),i(t)("form").each(function(){m(this)}),console.log("Welcome to the ZMS Ticketprinter interface..."),i(t)(document).ready(function(){i(t)(".eintragen").on("click",function(e){e.preventDefault();let n=i(t)(this).text();i(t)(".eintragen").prop("disabled",!0).addClass("disabled"),setTimeout(()=>{i(t)(this).text(n),i(t)(this).closest("form").submit()},0)})});
//# sourceMappingURL=index.js.map
